# OoD_Gen-Chest_Xray-REx
Out-of-Distribution Generalization of Chest X-ray Using Risk Extrapolation

## Requirements (Installations)
Install the following libraries/packages with `pip`
```
torch 
torchvision
torchxrayvsion
```
## Seven (7) Pathologies, Four (4) Datasets, & Twelve Training Settings
There are 12 different training, validation and test settings generated by combining 4 different Chest X-ray datasets (NIH ChestX-ray8 dataset, PadChest dataset, CheXpert, and MIMIC-CXR). These 12 settings are broken down into 6 splits (ranging from 0 to 5) that can be called by passing the argument `--split=<split>`. For each split, you have the option to choose between 2 validation datasets by passing the argument `--valid_data=<name of valid dataset>`. 
The dataset names are condensed as short strings: `"nih"`= NIH ChestX-ray8 dataset, `"pc"` = PadChest dataset, `"cx"` = CheXpert, and `"mc"` = MIMIC-CXR. \
For each setting, we compute the ROC-AUC for the following chest x-ray pathologies (labels): Cardiomegaly, Pneumonia, Effusion, Edema, Atelectasis, Consolidation, and Pneumothorax.

For each split, you train on two (2) datasets, validate on one (1) and test on the remaining one (1). \
The [baseline_rex.py](https://github.com/etetteh/OoD_Gen-Chest_Xray-REx/blob/main/baseline_rex.py) file contains code to run both our baseline and REx models.

### Train Using Baseline Model
To train the baseline model on the first split, and validate on the MIMIC-CXR dataset, run the following code:
```
python baseline_rex.py --split=0 --valid_data="mc"
```
Note that for the first split, PadChest is automatically selected as the `test_data`, when you pass MIMIC-CXR as the validation data, and vice versa.

### Train Using REx Model
To train the REx model, we run the same code above with some addtional arguments. We first turn off the baseline approach by passing the argument 
`--baseline=False`, and also specify the amount of penalty weight (float in multiples of 10) to use by passing `--penalty_weight=<penalty weight amount>`. Example: 
```
python baseline_rex.py --baseline=False --penalty_weight=100.0 --split=0 --valid_data="mc"
```

## Something smaller? Three (3) Training Settings with Varying Pathologies
Coming Soon ------>
